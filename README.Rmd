# BI-ENRICH-LN

Here is the reproducible code for BI-ENRICH pathway analysis that applied for figure 2 in the paper, Meta-analysis of over 100,000 individuals of European ancestry identifies 19 genome-wide significant risk loci for restless legs syndrome. 

## load data

```{r, eval=F}
load("data/annotation_matrix_gs.rda") # annotation_matrix_gs
colnames(annotation_matrix_gs)
```
A matrix indicate annotation of 16903 genes in 6121 gene sets.

```{r, eval=F}
load("data/candidategeneset.rda") # annotation_matrix_gs
head(cs) # two columns: gene name; loci id
```

## BI-ENRICH pathway enrichment

### calculate z score 

```{r, eval=F}

ncores = 2;                # number of cores for parallel computing
bienrich_pval = 0.05;      # p-value cutoff to perform greedy search for the potention multiple mixed gene sets.
shrinking_geneset = TRUE ; # shrinking the all the gene sets by full overlap, the larger one will be remove to accelerate computing 

source("src/calculate_geneset_zscore.R")

zcs2gs_res_list <- calculate_geneset_zscore( cs=cs,
				             annotation_matrix_gs = annotation_matrix_gs, 
					     ncores=ncores, 
					     bienrich_pval=bienrich_pval,
				             shrinking_geneset=TRUE)

zcs2gs_res <- zcs2gs_res_list[[1]]
annotation_matrix <- zcs2gs_res_list[[2]]
save(annotation_matrix,file="annotation_matrix_gs_sk.rda")
head(zcs2gs_res[order(zcs2gs_res[,1],decreasing=T),],3)
```
```
           z                   anno
104 5.689770 GO_LOCOMOTORY_BEHAVIOR
115 5.566328            GO_BEHAVIOR
14  5.480649     UNIKB_Neurogenesis

```
### calculate random sampling z-score

```{r, eval=F}

source("src/calculate_geneset_zscore_sampling.R")
permute_gs <- calculate_geneset_zscore_sampling(times=10000,cs,annotation_matrix, ncores=8, bienrich_pval=0.05,shrinking_geneset=FALSE){
save(permute_gs,file="permute_gs.1000.Rda")

```

### calculate random sampling adjusted significance

```{r, eval=F}

source("src/calculate_geneset_sampling_adjusted.R")
gs_enrich_stats <- calculate_geneset_sampling_adjusted(zcs2gs_res,permute_gs)
head(gs_enrich_stats[order(gs_enrich_stats$zraw,decreasing=T),],3)

```
                                      Geneset       pvalue   fdr     zraw                        genes
GO_LOCOMOTORY_BEHAVIOR GO_LOCOMOTORY_BEHAVIOR 3.036278e-07 0.000 5.689770       BTBD9 CLN6 HOXB8 MEIS1
GO_BEHAVIOR                       GO_BEHAVIOR 1.220011e-04 0.007 5.566328 BTBD9 CLN6 DACH1 HOXB8 MEIS1
UNIKB_Neurogenesis         UNIKB_Neurogenesis 2.691943e-06 0.000 5.480649      MDGA1 MYT1 NTNG1 SEMA6D

```

```


